# https://circleci.com/gh/spyder-ide/qtpy/
machine:
  environment:
    # Used by test scripts
    TEST_CI: "True"
    # Python versions to test (Maximum of 4 different versions for now)
    PY_VERSIONS: "2.7 3.5 3.6"
    # For Coveralls
    COVERALLS_REPO_TOKEN: xh75EzxFFMoTEyNPo3wXxXv8OVkul3eE5
    # Used by astropy-ci helpers
    TRAVIS_OS_NAME: "linux"
    CONDA_DEPENDENCIES: "pytest pytest-cov"
    PIP_DEPENDENCIES: "coveralls"

dependencies:
  override:
    # First convert PY_VERSIONS to an array and then select the Python version
    # based on the CIRCLE_NODE_INDEX
    - PY_VERSIONS=($PY_VERSIONS) &&
      TRAVIS_PYTHON_VERSION=${PY_VERSIONS[$CIRCLE_NODE_INDEX]} && 
      echo -e "PYTHON = $TRAVIS_PYTHON_VERSION \n============" &&
      git clone git://github.com/astropy/ci-helpers.git &&
      source ci-helpers/travis/setup_conda_$TRAVIS_OS_NAME.sh &&
      export PATH="$HOME/miniconda/bin:$PATH" &&
      source activate test &&
      python setup.py develop;

test:
  override:
    # Check PyQt5
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && conda install -q qt=5.* pyqt=5.* && python qtpy/tests/runtests.py: # note the colon
        parallel: true
    # Check PySide2
#    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && conda install -q qt=5.* pyside2 && python qtpy/tests/runtests.py: # note the colon
#        parallel: true
    # Check PyQt4
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && conda install -q qt=4.* pyqt=4.* && python qtpy/tests/runtests.py: # note the colon
        parallel: true
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && coveralls: # note the colon
        parallel: true
    # Check Pyside
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate test && conda remove -q qt pyqt && conda install -c conda-forge qt=4.* pyside && python qtpy/tests/runtests.py: # note the colon
        parallel: true
